# BoLuo (è è) ğŸ“¸

[![npm version](https://badge.fury.io/js/boluo.svg)](https://badge.fury.io/js/boluo)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![TypeScript](https://img.shields.io/badge/TypeScript-Ready-blue.svg)](https://www.typescriptlang.org/)

## ğŸŒ Languages / è¯­è¨€

- [ğŸ‡¨ğŸ‡³ ä¸­æ–‡](#ä¸­æ–‡ç‰ˆæœ¬)
- [ğŸ‡ºğŸ‡¸ English](#english-version)

---

## ä¸­æ–‡ç‰ˆæœ¬

> çº¯å‰ç«¯å›¾ç‰‡å‹ç¼©åº“ï¼ŒåŸºäºå¾®ä¿¡æœ‹å‹åœˆå‹ç¼©ç®—æ³•ï¼Œæ— éœ€ Canvasï¼Œæ”¯æŒ Blob ç›´æ¥å‹ç¼©

BoLuo æ˜¯åŸºäº [Android Luban](https://github.com/Curzibn/Luban) å‹ç¼©ç®—æ³•çš„çº¯å‰ç«¯ TypeScript å®ç°ç‰ˆæœ¬ã€‚Luban ç®—æ³•é€šè¿‡é€†å‘åˆ†æå¾®ä¿¡æœ‹å‹åœˆçš„å›¾ç‰‡å‹ç¼©ç­–ç•¥è€Œæ¥ï¼Œèƒ½å¤Ÿåœ¨ä¿æŒè§†è§‰è´¨é‡çš„åŒæ—¶æ˜¾è‘—å‡å°å›¾ç‰‡æ–‡ä»¶å¤§å°ã€‚

## ğŸ¯ å…³äº Luban ç®—æ³•

Lubanï¼ˆé²ç­ï¼‰ç®—æ³•æ˜¯é€šè¿‡åœ¨å¾®ä¿¡æœ‹å‹åœˆå‘é€è¿‘100å¼ ä¸åŒåˆ†è¾¨ç‡å›¾ç‰‡ï¼Œå¯¹æ¯”åŸå›¾ä¸å¾®ä¿¡å‹ç¼©åçš„å›¾ç‰‡é€†å‘æ¨ç®—å‡ºæ¥çš„å‹ç¼©ç®—æ³•ã€‚è™½ç„¶æ˜¯é€†å‘æ¨ç®—ï¼Œä½†æ•ˆæœå·²ç»éå¸¸æ¥è¿‘å¾®ä¿¡æœ‹å‹åœˆå‹ç¼©åçš„æ•ˆæœã€‚

### å‹ç¼©æ•ˆæœå¯¹æ¯”

| å†…å®¹ | åŸå›¾ | Luban å‹ç¼© | å¾®ä¿¡å‹ç¼© |
|------|------|------------|----------|
| æˆªå± 720P | 720Ã—1280, 390KB | 720Ã—1280, 87KB | 720Ã—1280, 56KB |
| æˆªå± 1080P | 1080Ã—1920, 2.21MB | 1080Ã—1920, 104KB | 1080Ã—1920, 112KB |
| æ‹ç…§ 13M(4:3) | 3096Ã—4128, 3.12MB | 1548Ã—2064, 141KB | 1548Ã—2064, 147KB |
| æ‹ç…§ 9.6M(16:9) | 4128Ã—2322, 4.64MB | 1032Ã—581, 97KB | 1032Ã—581, 74KB |

*æ•°æ®æ¥æºï¼šAndroid Luban é¡¹ç›®æµ‹è¯•ç»“æœ*

## âœ¨ ç‰¹æ€§

- ğŸš€ **å¾®ä¿¡çº§å‹ç¼©ç®—æ³•** - åŸºäºé€†å‘åˆ†æå¾®ä¿¡æœ‹å‹åœˆå‹ç¼©ç­–ç•¥
- ğŸŒ **çº¯å‰ç«¯å®ç°** - æ— éœ€æœåŠ¡å™¨ï¼Œç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ
- ğŸ“¦ **TypeScript åŸç”Ÿæ”¯æŒ** - å®Œæ•´çš„ç±»å‹å®šä¹‰ï¼Œä¼˜ç§€çš„å¼€å‘ä½“éªŒ
- ğŸ¯ **æ™ºèƒ½å‹ç¼©ç­–ç•¥** - è‡ªåŠ¨è®¡ç®—æœ€ä½³å‹ç¼©å‚æ•°ï¼Œå¹³è¡¡æ–‡ä»¶å¤§å°ä¸å›¾ç‰‡è´¨é‡
- ğŸ“ **Blob ç›´æ¥å¤„ç†** - æ”¯æŒ File/Blob å¯¹è±¡ç›´æ¥å‹ç¼©ï¼Œæ— éœ€æ–‡ä»¶ç³»ç»Ÿ
- ğŸ¨ **é€æ˜é€šé“ä¿æŒ** - å¯é€‰æ‹©ä¿ç•™ PNG å›¾ç‰‡çš„é€æ˜é€šé“
- ğŸ“Š **è¯¦ç»†å‹ç¼©ç»Ÿè®¡** - æä¾›å‹ç¼©å‰åçš„è¯¦ç»†å¯¹æ¯”æ•°æ®
- ğŸš« **æ—  Canvas ä¾èµ–** - ä¸ä¾èµ– Canvas APIï¼Œå…¼å®¹æ€§æ›´å¥½

## ğŸ“¦ å®‰è£…

```bash
npm install boluo-image
```

æˆ–ä½¿ç”¨ yarn:

```bash
yarn add boluo-image
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºç¡€ç”¨æ³•

```typescript
import BoLuo from 'boluo-image';

// å‹ç¼©å•ä¸ª Blob/File
const compressedBuffer = await BoLuo.compress(fileBlob);
console.log('å‹ç¼©å®Œæˆï¼Œè¿”å› Buffer');

// å‹ç¼©å¤šä¸ª Blob/File
const compressedBuffers = await BoLuo.compressMultiple([blob1, blob2, blob3]);
console.log('æ‰¹é‡å‹ç¼©å®Œæˆ');
```

### ä½¿ç”¨æ„å»ºå™¨æ¨¡å¼

```typescript
import { BoLuo } from 'boluo-image';

// ä» File å¯¹è±¡å‹ç¼©
const result = await BoLuo.create()
  .load(fileInput.files[0])       // åŠ è½½ File å¯¹è±¡
  .quality(80)                    // è®¾ç½®å‹ç¼©è´¨é‡ (0-100)
  .ignoreBy(100)                  // å°äº100KBçš„æ–‡ä»¶ä¸å‹ç¼©
  .setFocusAlpha(true)           // ä¿ç•™é€æ˜é€šé“
  .compress();

console.log('å‹ç¼©ç»“æœ:', result);

// ä» Blob å‹ç¼©
const buffer = await BoLuo.create()
  .load(imageBlob)
  .quality(75)
  .compressToBuffer();           // è¿”å› Buffer

// è½¬æ¢ä¸ºæ–°çš„ Blob
const compressedBlob = new Blob([buffer], { type: 'image/jpeg' });
```

### Web åº”ç”¨ä¸­çš„ä½¿ç”¨

```typescript
import { BoLuo } from 'boluo-image';

// å¤„ç†æ–‡ä»¶ä¸Šä¼ 
const handleFileUpload = async (event: Event) => {
  const file = (event.target as HTMLInputElement).files?.[0];
  if (!file) return;

  try {
    const result = await BoLuo.create()
      .load(file)
      .quality(80)
      .compress();

    console.log(`åŸå§‹å¤§å°: ${result.originalSize} bytes`);
    console.log(`å‹ç¼©åå¤§å°: ${result.compressedSize} bytes`);
    console.log(`å‹ç¼©æ¯”: ${result.compressionRatio.toFixed(2)}%`);

    // åˆ›å»ºå‹ç¼©åçš„ Blob
    const compressedBuffer = await BoLuo.create()
      .load(file)
      .quality(80)
      .compressToBuffer();
    
    const compressedBlob = new Blob([compressedBuffer], { type: 'image/jpeg' });
    
    // å¯ä»¥ç”¨äºä¸Šä¼ æˆ–æ˜¾ç¤º
    const formData = new FormData();
    formData.append('image', compressedBlob, 'compressed.jpg');
    
  } catch (error) {
    console.error('å‹ç¼©å¤±è´¥:', error);
  }
};

// åœ¨ HTML ä¸­
// <input type="file" accept="image/*" onChange={handleFileUpload} />
```

### æ‰¹é‡å¤„ç†å¤šä¸ªæ–‡ä»¶

```typescript
import { BoLuo } from 'boluo-image';

const handleMultipleFiles = async (files: FileList) => {
  const fileArray = Array.from(files);
  
  // æ–¹æ³•1ï¼šä½¿ç”¨é™æ€æ–¹æ³•æ‰¹é‡å‹ç¼©
  const compressedBuffers = await BoLuo.compressMultiple(fileArray, {
    quality: 75,
    ignoreBy: 50
  });

  // æ–¹æ³•2ï¼šä½¿ç”¨æ„å»ºå™¨é€ä¸ªå¤„ç†
  const results = [];
  for (const file of fileArray) {
    const result = await BoLuo.create()
      .load(file)
      .quality(75)
      .compress();
    results.push(result);
  }

  console.log('æ‰€æœ‰æ–‡ä»¶å‹ç¼©å®Œæˆ:', results);
};
```

### React ç»„ä»¶ç¤ºä¾‹

```tsx
import React, { useState } from 'react';
import { BoLuo } from 'boluo-image';

const ImageCompressor: React.FC = () => {
  const [compressing, setCompressing] = useState(false);
  const [result, setResult] = useState<any>(null);

  const handleCompress = async (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0];
    if (!file) return;

    setCompressing(true);
    try {
      const compressionResult = await BoLuo.create()
        .load(file)
        .quality(80)
        .compress();

      setResult(compressionResult);
    } catch (error) {
      console.error('å‹ç¼©å¤±è´¥:', error);
    } finally {
      setCompressing(false);
    }
  };

  return (
    <div>
      <input 
        type="file" 
        accept="image/*" 
        onChange={handleCompress}
        disabled={compressing}
      />
      
      {compressing && <p>å‹ç¼©ä¸­...</p>}
      
      {result && (
        <div>
          <p>åŸå§‹å¤§å°: {(result.originalSize / 1024).toFixed(2)} KB</p>
          <p>å‹ç¼©åå¤§å°: {(result.compressedSize / 1024).toFixed(2)} KB</p>
          <p>å‹ç¼©æ¯”: {result.compressionRatio.toFixed(2)}%</p>
          <p>å°ºå¯¸: {result.width} Ã— {result.height}</p>
        </div>
      )}
    </div>
  );
};

export default ImageCompressor;
```

## ğŸ“– API æ–‡æ¡£

### BoLuo ç±»

#### é™æ€æ–¹æ³•

- `BoLuo.create()`: åˆ›å»º BoLuoBuilder å®ä¾‹
- `BoLuo.compress(blob, options?)`: å‹ç¼©å•ä¸ª Blob/Fileï¼Œè¿”å› Buffer
- `BoLuo.compressMultiple(blobs, options?)`: å‹ç¼©å¤šä¸ª Blob/Fileï¼Œè¿”å› Buffer æ•°ç»„

### BoLuoBuilder ç±»

#### é…ç½®æ–¹æ³•

| æ–¹æ³• | å‚æ•° | æè¿° |
|------|------|------|
| `load(input)` | `Blob \| File` | åŠ è½½ Blob æˆ– File å¯¹è±¡ |
| `quality(quality)` | `number (0-100)` | è®¾ç½®å‹ç¼©è´¨é‡ï¼Œé»˜è®¤ 60 |
| `ignoreBy(size)` | `number` | è®¾ç½®æœ€å°å‹ç¼©é˜ˆå€¼ (KB)ï¼Œé»˜è®¤ 100 |
| `setFocusAlpha(focusAlpha)` | `boolean` | æ˜¯å¦ä¿ç•™é€æ˜é€šé“ï¼Œé»˜è®¤ false |

#### æ‰§è¡Œæ–¹æ³•

- `compress()`: å‹ç¼©å¹¶è¿”å›è¯¦ç»†ç»“æœä¿¡æ¯
- `compressToBuffer()`: å‹ç¼©å¹¶è¿”å› Buffer

### ç±»å‹å®šä¹‰

```typescript
interface CompressionOptions {
  quality?: number;           // å‹ç¼©è´¨é‡ (0-100)
  ignoreBy?: number;         // æœ€å°å‹ç¼©é˜ˆå€¼ (KB)
  focusAlpha?: boolean;      // æ˜¯å¦ä¿ç•™é€æ˜é€šé“
}

interface CompressionResult {
  originalSize: number;      // åŸå§‹æ–‡ä»¶å¤§å° (bytes)
  compressedSize: number;    // å‹ç¼©åæ–‡ä»¶å¤§å° (bytes)
  compressionRatio: number;  // å‹ç¼©æ¯”ä¾‹ (0-100)
  width: number;             // å›¾ç‰‡å®½åº¦
  height: number;            // å›¾ç‰‡é«˜åº¦
  format: string;            // å›¾ç‰‡æ ¼å¼
}

interface ImageInfo {
  width: number;             // å›¾ç‰‡å®½åº¦
  height: number;            // å›¾ç‰‡é«˜åº¦
  format: string;            // å›¾ç‰‡æ ¼å¼
  size: number;              // æ–‡ä»¶å¤§å°
  orientation?: number;      // æ—‹è½¬ä¿¡æ¯
}
```

## ğŸ”§ é…ç½®é€‰é¡¹

| é€‰é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|------|------|--------|------|
| `quality` | number | 60 | å‹ç¼©è´¨é‡ï¼ŒèŒƒå›´ 0-100ï¼Œæ•°å€¼è¶Šé«˜è´¨é‡è¶Šå¥½ |
| `ignoreBy` | number | 100 | æœ€å°å‹ç¼©é˜ˆå€¼(KB)ï¼Œå°äºæ­¤å€¼çš„æ–‡ä»¶ä¸è¿›è¡Œå‹ç¼© |
| `focusAlpha` | boolean | false | æ˜¯å¦ä¿ç•™ PNG å›¾ç‰‡çš„é€æ˜é€šé“ |

## ğŸ¯ ä½¿ç”¨åœºæ™¯

- **Web å‰ç«¯åº”ç”¨** - ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡å‰è¿›è¡Œå‹ç¼©ï¼Œå‡å°‘ä¸Šä¼ æ—¶é—´å’ŒæœåŠ¡å™¨å­˜å‚¨
- **ç§»åŠ¨ç«¯ Web åº”ç”¨** - åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå‹ç¼©å›¾ç‰‡ï¼ŒèŠ‚çœæµé‡
- **å›¾ç‰‡ç¼–è¾‘å™¨** - æä¾›å›¾ç‰‡å‹ç¼©åŠŸèƒ½
- **ç¤¾äº¤åº”ç”¨** - ç±»ä¼¼å¾®ä¿¡æœ‹å‹åœˆçš„å›¾ç‰‡å‹ç¼©ä½“éªŒ
- **ç”µå•†å¹³å°** - å•†å“å›¾ç‰‡ä¸Šä¼ å‰å‹ç¼©
- **å†…å®¹ç®¡ç†ç³»ç»Ÿ** - æ–‡ç« é…å›¾è‡ªåŠ¨å‹ç¼©

## ğŸŒ æµè§ˆå™¨å…¼å®¹æ€§

- Chrome 50+
- Firefox 45+
- Safari 10+
- Edge 79+
- ç§»åŠ¨ç«¯æµè§ˆå™¨æ”¯æŒ

## ğŸš« ä¸ä¾èµ–çš„æŠ€æœ¯

- âŒ Canvas API
- âŒ Node.js æ–‡ä»¶ç³»ç»Ÿ
- âŒ æœåŠ¡å™¨ç«¯å¤„ç†
- âŒ WebAssembly

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºä½ çš„ç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤ä½ çš„ä¿®æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ä¸€ä¸ª Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- æ„Ÿè°¢ [Curzibn/Luban](https://github.com/Curzibn/Luban) æä¾›çš„åŸå§‹ Android å‹ç¼©ç®—æ³•
- æ„Ÿè°¢ [Sharp](https://sharp.pixelplumbing.com/) æä¾›çš„å¼ºå¤§å›¾ç‰‡å¤„ç†èƒ½åŠ›
- æ„Ÿè°¢å¾®ä¿¡å›¢é˜Ÿçš„ä¼˜ç§€å‹ç¼©ç®—æ³•è®¾è®¡

## ğŸ”— ç›¸å…³é“¾æ¥

- [åŸç‰ˆ Android Luban](https://github.com/Curzibn/Luban) - åŸå§‹çš„ Android å›¾ç‰‡å‹ç¼©åº“
- [Sharp æ–‡æ¡£](https://sharp.pixelplumbing.com/) - åº•å±‚å›¾ç‰‡å¤„ç†å¼•æ“

---

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™å®ƒä¸€ä¸ª â­ï¸ï¼

---

## English Version

> Pure frontend image compression library based on WeChat Moments compression algorithm, Canvas-free, supports direct Blob compression

BoLuo is a pure frontend TypeScript implementation of the [Android Luban](https://github.com/Curzibn/Luban) compression algorithm. The Luban algorithm was reverse-engineered by analyzing WeChat Moments' image compression strategy, enabling significant file size reduction while maintaining visual quality.

## ğŸ¯ About Luban Algorithm

The Luban algorithm was reverse-engineered by sending nearly 100 images of different resolutions through WeChat Moments and comparing the original images with WeChat's compressed versions. Although it's reverse-engineered, the results are very close to WeChat Moments' compression effects.

## âœ¨ Features

- ğŸš€ **WeChat-level compression algorithm** - Based on reverse analysis of WeChat Moments compression strategy
- ğŸŒ **Pure frontend implementation** - No server required, runs directly in browsers
- ğŸ“¦ **Native TypeScript support** - Complete type definitions for excellent development experience
- ğŸ¯ **Smart compression strategy** - Automatically calculates optimal compression parameters
- ğŸ“ **Direct Blob processing** - Supports File/Blob objects directly, no file system needed
- ğŸ¨ **Transparency preservation** - Optional preservation of PNG transparency channels
- ğŸ“Š **Detailed compression statistics** - Provides detailed comparison data
- ğŸš« **Canvas-free** - No Canvas API dependency, better compatibility

## ğŸ“¦ Installation

```bash
npm install boluo-image
```

## ğŸš€ Quick Start

### Basic Usage

```typescript
import BoLuo from 'boluo-image';

// Compress a single Blob/File
const compressedBuffer = await BoLuo.compress(fileBlob);
console.log('Compression completed, Buffer returned');

// Compress multiple Blob/File objects
const compressedBuffers = await BoLuo.compressMultiple([blob1, blob2, blob3]);
console.log('Batch compression completed');
```

### Using Builder Pattern

```typescript
import { BoLuo } from 'boluo-image';

// Compress from File object
const result = await BoLuo.create()
  .load(fileInput.files[0])       // Load File object
  .quality(80)                    // Set compression quality (0-100)
  .ignoreBy(100)                  // Don't compress files smaller than 100KB
  .setFocusAlpha(true)           // Preserve transparency channel
  .compress();

console.log('Compression result:', result);

// Compress from Blob
const buffer = await BoLuo.create()
  .load(imageBlob)
  .quality(75)
  .compressToBuffer();           // Return Buffer

// Convert to new Blob
const compressedBlob = new Blob([buffer], { type: 'image/jpeg' });
```

### Usage in Web Applications

```typescript
import { BoLuo } from 'boluo-image';

// Handle file upload
const handleFileUpload = async (event: Event) => {
  const file = (event.target as HTMLInputElement).files?.[0];
  if (!file) return;

  try {
    const result = await BoLuo.create()
      .load(file)
      .quality(80)
      .compress();

    console.log(`Original size: ${result.originalSize} bytes`);
    console.log(`Compressed size: ${result.compressedSize} bytes`);
    console.log(`Compression ratio: ${result.compressionRatio.toFixed(2)}%`);

    // Create compressed Blob
    const compressedBuffer = await BoLuo.create()
      .load(file)
      .quality(80)
      .compressToBuffer();
    
    const compressedBlob = new Blob([compressedBuffer], { type: 'image/jpeg' });
    
    // Can be used for upload or display
    const formData = new FormData();
    formData.append('image', compressedBlob, 'compressed.jpg');
    
  } catch (error) {
    console.error('Compression failed:', error);
  }
};
```

## ğŸ“– API Documentation

### BoLuo Class

#### Static Methods

- `BoLuo.create()`: Create BoLuoBuilder instance
- `BoLuo.compress(blob, options?)`: Compress single Blob/File, returns Buffer
- `BoLuo.compressMultiple(blobs, options?)`: Compress multiple Blob/File objects, returns Buffer array

### BoLuoBuilder Class

#### Configuration Methods

| Method | Parameters | Description |
|--------|------------|-------------|
| `load(input)` | `Blob \| File` | Load Blob or File object |
| `quality(quality)` | `number (0-100)` | Set compression quality, default 60 |
| `ignoreBy(size)` | `number` | Set minimum compression threshold (KB), default 100 |
| `setFocusAlpha(focusAlpha)` | `boolean` | Whether to preserve transparency channel, default false |

#### Execution Methods

- `compress()`: Compress and return detailed result information
- `compressToBuffer()`: Compress and return Buffer

## ğŸŒ Browser Compatibility

- Chrome 50+
- Firefox 45+
- Safari 10+
- Edge 79+
- Mobile browsers supported

## ğŸš« No Dependencies On

- âŒ Canvas API
- âŒ Node.js file system
- âŒ Server-side processing
- âŒ WebAssembly

## ğŸ¤ Contributing

Issues and Pull Requests are welcome!

## ğŸ“„ License

This project is licensed under the MIT License.

## ğŸ™ Acknowledgments

- Thanks to [Curzibn/Luban](https://github.com/Curzibn/Luban) for providing the original Android compression algorithm
- Thanks to [Sharp](https://sharp.pixelplumbing.com/) for providing powerful image processing capabilities
- Thanks to the WeChat team for their excellent compression algorithm design

---

If this project helps you, please give it a â­ï¸!