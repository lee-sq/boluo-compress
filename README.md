# BoLuo (è è) ğŸ“¸

[![npm version](https://badge.fury.io/js/boluo.svg)](https://badge.fury.io/js/boluo)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![TypeScript](https://img.shields.io/badge/TypeScript-Ready-blue.svg)](https://www.typescriptlang.org/)

> TypeScript ç‰ˆæœ¬çš„ Luban å›¾ç‰‡å‹ç¼©åº“ï¼ŒåŸºäºå¾®ä¿¡æœ‹å‹åœˆå‹ç¼©ç®—æ³•

BoLuo æ˜¯ [Android Luban](https://github.com/Curzibn/Luban) å‹ç¼©ç®—æ³•çš„ TypeScript å®ç°ç‰ˆæœ¬ï¼Œä¸“ä¸º Node.js ç¯å¢ƒè®¾è®¡ã€‚Luban ç®—æ³•é€šè¿‡é€†å‘åˆ†æå¾®ä¿¡æœ‹å‹åœˆçš„å›¾ç‰‡å‹ç¼©ç­–ç•¥è€Œæ¥ï¼Œèƒ½å¤Ÿåœ¨ä¿æŒè§†è§‰è´¨é‡çš„åŒæ—¶æ˜¾è‘—å‡å°å›¾ç‰‡æ–‡ä»¶å¤§å°ã€‚<mcreference link="https://github.com/Curzibn/Luban" index="0">0</mcreference>

## ğŸ¯ å…³äº Luban ç®—æ³•

Lubanï¼ˆé²ç­ï¼‰ç®—æ³•æ˜¯é€šè¿‡åœ¨å¾®ä¿¡æœ‹å‹åœˆå‘é€è¿‘100å¼ ä¸åŒåˆ†è¾¨ç‡å›¾ç‰‡ï¼Œå¯¹æ¯”åŸå›¾ä¸å¾®ä¿¡å‹ç¼©åçš„å›¾ç‰‡é€†å‘æ¨ç®—å‡ºæ¥çš„å‹ç¼©ç®—æ³•ã€‚<mcreference link="https://github.com/Curzibn/Luban" index="0">0</mcreference> è™½ç„¶æ˜¯é€†å‘æ¨ç®—ï¼Œä½†æ•ˆæœå·²ç»éå¸¸æ¥è¿‘å¾®ä¿¡æœ‹å‹åœˆå‹ç¼©åçš„æ•ˆæœã€‚

### å‹ç¼©æ•ˆæœå¯¹æ¯”

| å†…å®¹ | åŸå›¾ | Luban å‹ç¼© | å¾®ä¿¡å‹ç¼© |
|------|------|------------|----------|
| æˆªå± 720P | 720Ã—1280, 390KB | 720Ã—1280, 87KB | 720Ã—1280, 56KB |
| æˆªå± 1080P | 1080Ã—1920, 2.21MB | 1080Ã—1920, 104KB | 1080Ã—1920, 112KB |
| æ‹ç…§ 13M(4:3) | 3096Ã—4128, 3.12MB | 1548Ã—2064, 141KB | 1548Ã—2064, 147KB |
| æ‹ç…§ 9.6M(16:9) | 4128Ã—2322, 4.64MB | 1032Ã—581, 97KB | 1032Ã—581, 74KB |

*æ•°æ®æ¥æºï¼šAndroid Luban é¡¹ç›®æµ‹è¯•ç»“æœ*<mcreference link="https://github.com/Curzibn/Luban" index="0">0</mcreference>

## âœ¨ ç‰¹æ€§

- ğŸš€ **å¾®ä¿¡çº§å‹ç¼©ç®—æ³•** - åŸºäºé€†å‘åˆ†æå¾®ä¿¡æœ‹å‹åœˆå‹ç¼©ç­–ç•¥
- ğŸ“¦ **TypeScript åŸç”Ÿæ”¯æŒ** - å®Œæ•´çš„ç±»å‹å®šä¹‰ï¼Œä¼˜ç§€çš„å¼€å‘ä½“éªŒ
- ğŸ”§ **é«˜æ€§èƒ½å¤„ç†** - åŸºäº Sharp å¼•æ“ï¼Œæä¾›å¿«é€Ÿçš„å›¾ç‰‡å¤„ç†èƒ½åŠ›
- ğŸ¯ **æ™ºèƒ½å‹ç¼©ç­–ç•¥** - è‡ªåŠ¨è®¡ç®—æœ€ä½³å‹ç¼©å‚æ•°ï¼Œå¹³è¡¡æ–‡ä»¶å¤§å°ä¸å›¾ç‰‡è´¨é‡
- ğŸ“ **æ‰¹é‡å¤„ç†æ”¯æŒ** - æ”¯æŒå•æ–‡ä»¶å’Œæ‰¹é‡æ–‡ä»¶å‹ç¼©
- ğŸ¨ **é€æ˜é€šé“ä¿æŒ** - å¯é€‰æ‹©ä¿ç•™ PNG å›¾ç‰‡çš„é€æ˜é€šé“
- ğŸ“Š **è¯¦ç»†å‹ç¼©ç»Ÿè®¡** - æä¾›å‹ç¼©å‰åçš„è¯¦ç»†å¯¹æ¯”æ•°æ®
- ğŸ” **çµæ´»è¿‡æ»¤æœºåˆ¶** - æ”¯æŒè‡ªå®šä¹‰æ–‡ä»¶è¿‡æ»¤å’Œé‡å‘½åè§„åˆ™

## ğŸ“¦ å®‰è£…

```bash
npm install boluo
```

æˆ–ä½¿ç”¨ yarn:

```bash
yarn add boluo
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºç¡€ç”¨æ³•

```typescript
import BoLuo from 'boluo';

// å‹ç¼©å•ä¸ªæ–‡ä»¶
const result = await BoLuo.compressFile('./input/image.jpg');
console.log(`å‹ç¼©å®Œæˆ: ${result.originalSize} -> ${result.compressedSize} bytes`);
console.log(`å‹ç¼©æ¯”: ${result.compressionRatio.toFixed(2)}%`);

// å‹ç¼©å¤šä¸ªæ–‡ä»¶
const results = await BoLuo.compressFiles([
  './input/image1.jpg',
  './input/image2.png'
]);
```

### ä½¿ç”¨æ„å»ºå™¨æ¨¡å¼

```typescript
import { BoLuo } from 'boluo';

const result = await BoLuo.create()
  .load('./input/image.jpg')
  .quality(80)                    // è®¾ç½®å‹ç¼©è´¨é‡ (0-100)
  .ignoreBy(100)                  // å°äº100KBçš„æ–‡ä»¶ä¸å‹ç¼©
  .setTargetDir('./output')       // è®¾ç½®è¾“å‡ºç›®å½•
  .setFocusAlpha(true)           // ä¿ç•™é€æ˜é€šé“
  .get();

console.log('å‹ç¼©ç»“æœ:', result);
```

### æ‰¹é‡å‹ç¼©ä¸ç›‘å¬

```typescript
import { BoLuo } from 'boluo';

await BoLuo.create()
  .load(['./images/*.jpg', './images/*.png'])
  .quality(75)
  .setTargetDir('./compressed')
  .filter(filePath => !filePath.includes('thumbnail')) // è¿‡æ»¤æ–‡ä»¶
  .setCompressListener({
    onStart: () => console.log('å¼€å§‹å‹ç¼©...'),
    onSuccess: (outputPath) => console.log(`å‹ç¼©æˆåŠŸ: ${outputPath}`),
    onError: (error) => console.error('å‹ç¼©å¤±è´¥:', error)
  })
  .launch();
```

### é«˜çº§ç”¨æ³• - è‡ªå®šä¹‰é‡å‘½å

```typescript
import { BoLuo } from 'boluo';

const result = await BoLuo.create()
  .load('./input/photo.jpg')
  .setTargetDir('./output')
  .setRenameListener((originalPath) => {
    const timestamp = Date.now();
    return `compressed_${timestamp}_${path.basename(originalPath)}`;
  })
  .get();
```

## ğŸ“– API æ–‡æ¡£

### BoLuo ç±»

#### é™æ€æ–¹æ³•

- `BoLuo.create()`: åˆ›å»º BoLuoBuilder å®ä¾‹
- `BoLuo.compressFile(filePath, options?)`: å‹ç¼©å•ä¸ªæ–‡ä»¶
- `BoLuo.compressFiles(filePaths, options?)`: å‹ç¼©å¤šä¸ªæ–‡ä»¶

### BoLuoBuilder ç±»

#### é…ç½®æ–¹æ³•

| æ–¹æ³• | å‚æ•° | æè¿° |
|------|------|------|
| `load(input)` | `string \| string[] \| Buffer` | åŠ è½½æ–‡ä»¶è·¯å¾„ã€è·¯å¾„æ•°ç»„æˆ– Buffer |
| `quality(quality)` | `number (0-100)` | è®¾ç½®å‹ç¼©è´¨é‡ï¼Œé»˜è®¤ 60 |
| `ignoreBy(size)` | `number` | è®¾ç½®æœ€å°å‹ç¼©é˜ˆå€¼ (KB)ï¼Œé»˜è®¤ 100 |
| `setFocusAlpha(focusAlpha)` | `boolean` | æ˜¯å¦ä¿ç•™é€æ˜é€šé“ï¼Œé»˜è®¤ false |
| `setTargetDir(targetDir)` | `string` | è®¾ç½®è¾“å‡ºç›®å½•ï¼Œé»˜è®¤ './compressed' |
| `filter(filterFn)` | `(filePath: string) => boolean` | è®¾ç½®æ–‡ä»¶è¿‡æ»¤å™¨ |
| `setRenameListener(renameFn)` | `(filePath: string) => string` | è®¾ç½®é‡å‘½åå›è°ƒ |
| `setCompressListener(listener)` | `CompressionListener` | è®¾ç½®å‹ç¼©ç›‘å¬å™¨ |

#### æ‰§è¡Œæ–¹æ³•

- `get()`: å‹ç¼©å¹¶è¿”å›å•ä¸ªç»“æœ
- `getAll()`: å‹ç¼©å¹¶è¿”å›æ‰€æœ‰ç»“æœ
- `launch()`: æ‰§è¡Œå‹ç¼©ï¼ˆæ— è¿”å›å€¼ï¼‰

### ç±»å‹å®šä¹‰

```typescript
interface CompressionOptions {
  quality?: number;           // å‹ç¼©è´¨é‡ (0-100)
  ignoreBy?: number;         // æœ€å°å‹ç¼©é˜ˆå€¼ (KB)
  focusAlpha?: boolean;      // æ˜¯å¦ä¿ç•™é€æ˜é€šé“
  targetDir?: string;        // è¾“å‡ºç›®å½•
  renameListener?: (filePath: string) => string;
  filter?: (filePath: string) => boolean;
}

interface CompressionResult {
  originalPath: string;      // åŸå§‹æ–‡ä»¶è·¯å¾„
  outputPath: string;        // è¾“å‡ºæ–‡ä»¶è·¯å¾„
  originalSize: number;      // åŸå§‹æ–‡ä»¶å¤§å° (bytes)
  compressedSize: number;    // å‹ç¼©åæ–‡ä»¶å¤§å° (bytes)
  compressionRatio: number;  // å‹ç¼©æ¯”ä¾‹ (0-100)
  width: number;             // å›¾ç‰‡å®½åº¦
  height: number;            // å›¾ç‰‡é«˜åº¦
}

interface CompressionListener {
  onStart?: () => void;                    // å‹ç¼©å¼€å§‹
  onSuccess?: (outputPath: string) => void; // å‹ç¼©æˆåŠŸ
  onError?: (error: Error) => void;        // å‹ç¼©å¤±è´¥
}
```

## ğŸ”§ é…ç½®é€‰é¡¹

| é€‰é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|------|------|--------|------|
| `quality` | number | 60 | å‹ç¼©è´¨é‡ï¼ŒèŒƒå›´ 0-100ï¼Œæ•°å€¼è¶Šé«˜è´¨é‡è¶Šå¥½ |
| `ignoreBy` | number | 100 | æœ€å°å‹ç¼©é˜ˆå€¼(KB)ï¼Œå°äºæ­¤å€¼çš„æ–‡ä»¶ä¸è¿›è¡Œå‹ç¼© |
| `focusAlpha` | boolean | false | æ˜¯å¦ä¿ç•™ PNG å›¾ç‰‡çš„é€æ˜é€šé“ |
| `targetDir` | string | './compressed' | å‹ç¼©åå›¾ç‰‡çš„è¾“å‡ºç›®å½•è·¯å¾„ |
| `filter` | function | æ’é™¤ GIF | æ–‡ä»¶è¿‡æ»¤å™¨å‡½æ•°ï¼Œè¿”å› true çš„æ–‡ä»¶ä¼šè¢«å‹ç¼© |

## ğŸ¯ ä½¿ç”¨åœºæ™¯

- **Web åç«¯æœåŠ¡** - å¤„ç†ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ï¼Œå‡å°‘å­˜å‚¨ç©ºé—´å’Œä¼ è¾“æ—¶é—´
- **å†…å®¹ç®¡ç†ç³»ç»Ÿ** - è‡ªåŠ¨å‹ç¼©ä¸Šä¼ çš„å›¾ç‰‡èµ„æº
- **å›¾ç‰‡å¤„ç†æœåŠ¡** - æä¾›å›¾ç‰‡å‹ç¼© API æœåŠ¡
- **æ‰¹é‡å›¾ç‰‡å¤„ç†** - å¯¹å¤§é‡å†å²å›¾ç‰‡è¿›è¡Œæ‰¹é‡å‹ç¼©
- **æ„å»ºå·¥å…·é›†æˆ** - åœ¨é¡¹ç›®æ„å»ºè¿‡ç¨‹ä¸­è‡ªåŠ¨ä¼˜åŒ–å›¾ç‰‡èµ„æº
- **ç§»åŠ¨ç«¯åå°** - ä¸ºç§»åŠ¨åº”ç”¨æä¾›é€‚åˆçš„å›¾ç‰‡å‹ç¼©æœåŠ¡

## ğŸ—ï¸ æ¶æ„è¯´æ˜

### ä¸å‰ç«¯çš„é…åˆä½¿ç”¨

```javascript
// å‰ç«¯ä¸Šä¼  (React/Vue/Angular ç­‰)
const uploadImage = async (file) => {
  const formData = new FormData();
  formData.append('image', file);
  
  const response = await fetch('/api/upload-and-compress', {
    method: 'POST',
    body: formData
  });
  
  return response.json();
};

// åç«¯å¤„ç† (Node.js + Express)
app.post('/api/upload-and-compress', upload.single('image'), async (req, res) => {
  try {
    const result = await BoLuo.compressFile(req.file.path, {
      quality: 75,
      targetDir: './public/compressed'
    });
    
    res.json({
      success: true,
      original: {
        size: result.originalSize,
        path: req.file.path
      },
      compressed: {
        size: result.compressedSize,
        path: result.outputPath,
        ratio: result.compressionRatio
      }
    });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});
```

## ğŸ”„ ä¸åŸç‰ˆ Android Luban çš„å¯¹åº”å…³ç³»

| Android Luban | BoLuo (TypeScript) | è¯´æ˜ |
|---------------|-------------------|------|
| `load()` | `load()` | åŠ è½½å›¾ç‰‡æ–‡ä»¶ |
| `ignoreBy()` | `ignoreBy()` | è®¾ç½®å‹ç¼©é˜ˆå€¼ |
| `setFocusAlpha()` | `setFocusAlpha()` | ä¿ç•™é€æ˜é€šé“ |
| `setTargetDir()` | `setTargetDir()` | è®¾ç½®è¾“å‡ºç›®å½• |
| `filter()` | `filter()` | æ–‡ä»¶è¿‡æ»¤å™¨ |
| `setCompressListener()` | `setCompressListener()` | å‹ç¼©ç›‘å¬å™¨ |
| `setRenameListener()` | `setRenameListener()` | é‡å‘½åç›‘å¬å™¨ |
| `launch()` | `launch()` | å¼‚æ­¥æ‰§è¡Œå‹ç¼© |
| `get()` | `get()` / `getAll()` | åŒæ­¥è·å–ç»“æœ |

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºä½ çš„ç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤ä½ çš„ä¿®æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ä¸€ä¸ª Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- æ„Ÿè°¢ [Curzibn/Luban](https://github.com/Curzibn/Luban) æä¾›çš„åŸå§‹ Android å‹ç¼©ç®—æ³•<mcreference link="https://github.com/Curzibn/Luban" index="0">0</mcreference>
- æ„Ÿè°¢ [Sharp](https://sharp.pixelplumbing.com/) æä¾›çš„å¼ºå¤§å›¾ç‰‡å¤„ç†èƒ½åŠ›
- æ„Ÿè°¢å¾®ä¿¡å›¢é˜Ÿçš„ä¼˜ç§€å‹ç¼©ç®—æ³•è®¾è®¡

## ğŸ”— ç›¸å…³é“¾æ¥

- [åŸç‰ˆ Android Luban](https://github.com/Curzibn/Luban) - åŸå§‹çš„ Android å›¾ç‰‡å‹ç¼©åº“
- [Sharp æ–‡æ¡£](https://sharp.pixelplumbing.com/) - åº•å±‚å›¾ç‰‡å¤„ç†å¼•æ“
- [å¾®ä¿¡æœ‹å‹åœˆå›¾ç‰‡å‹ç¼©ç®—æ³•åˆ†æ](https://github.com/Curzibn/Luban#é¡¹ç›®æè¿°) - ç®—æ³•åŸç†è¯´æ˜

---

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™å®ƒä¸€ä¸ª â­ï¸ï¼